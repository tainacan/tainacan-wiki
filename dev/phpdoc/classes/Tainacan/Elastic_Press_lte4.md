***

# Elastic_Press_lte4





* Full name: `\Tainacan\Elastic_Press_lte4`
* **Warning:** this class is **deprecated**. This means that this class will likely be removed in a future version.



## Properties


### last_aggregations



```php
public $last_aggregations
```






***

### facets



```php
public $facets
```






***

### aggregation_type



```php
private $aggregation_type
```






***

### instance



```php
private static $instance
```



* This property is **static**.


***

## Methods


### get_instance



```php
public static get_instance(): mixed
```



* This method is **static**.








***

### __construct



```php
protected __construct(mixed $ajax_query = false): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$ajax_query` | **mixed** |  |





***

### is_active



```php
public is_active(): mixed
```












***

### init



```php
public init(): mixed
```












***

### elasticpress_config_mapping



```php
public elasticpress_config_mapping(mixed $mapping): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$mapping` | **mixed** |  |





***

### ep_post_sync_args



```php
public ep_post_sync_args(mixed $post_args, mixed $post_id): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$post_args` | **mixed** |  |
| `$post_id` | **mixed** |  |





***

### filter_args



```php
public filter_args(mixed $args, mixed $type): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$args` | **mixed** |  |
| `$type` | **mixed** |  |





***

### add_items_args



```php
private add_items_args(mixed $args): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$args` | **mixed** |  |





***

### prepare_request

Create a formatted array of args to send to elasticpress containing the aggregations for items or for one single facet depending on the request

```php
public prepare_request(\Array $formatted_args, mixed $args): \Array
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$formatted_args` | **\Array** | initial array generated by plugin elasticpress |
| `$args` | **mixed** |  |


**Return Value:**

with formatted array of args.




***

### format_aggregations

Formats the response from Elastic Search to Tainacan API format

```php
public format_aggregations(mixed $aggregations): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$aggregations` | **mixed** |  |





***

### fetch_all_metadatum_values



```php
public fetch_all_metadatum_values(mixed $return, mixed $metadatum, mixed $args): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$return` | **mixed** |  |
| `$metadatum` | **mixed** |  |
| `$args` | **mixed** |  |





***

### prepare_request_for_items

Prepare the request to fetch items with information about all facets
Used by the /items API endpoint
WIll add all the facets (filters) for the current collection

```php
private prepare_request_for_items(mixed $formatted_args): mixed
```

JSON exemple:

{
  "from" : 0,
  "size" : 12,
  "sort" : [ { "post_date" : { "order" : "desc" } } ],
  "query" : { "match_all":{ "boost":1 } },
  "post_filter" : {
    "bool" : {
      "must" : [
         { "term" : { "post_type.raw" : "tnc_col_6_item" } },
         { "term" : { "post_status":"publish" } }
      ]
    }
  },
  "aggs" : {
    "872.taxonomy.tnc_tax_5" : {
      "filter" : {
         "bool" : {
            "must" : [
               { "term" : { "post_type.raw":"tnc_col_6_item" } },
               { "term" : { "post_status":"publish" } }
            ]
         }
      },
      "aggs":{
         "872.taxonomy.tnc_tax_5":{
            "terms":{
               "size":"4",
               "script":{
                  "lang":"painless",
                  "source":"def c= ['']; for(term in params._source.terms.tnc_tax_5) { if(term.parent==0) { c.add(term.term_id); }} return c;"
               }
            }
         }
      }
    },
    "1026.meta.14" : {
      "filter":{
         "bool":{
            "must":[
               { "term" : { "post_type.raw":"tnc_col_6_item" } },
               { "term" : { "post_status":"publish" } }
            ]
         }
      },
      "aggs":{
         "1026.meta.14":{
            "terms":{
              "size":"4",
              "field":"meta.14.raw"
            }
         }
      }
    }
  }
}






**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$formatted_args` | **mixed** |  |





***

### prepare_request_for_facet

Prepare the request to get information about one facet (facets API endpoint)

```php
private prepare_request_for_facet(mixed $formatted_args): mixed
```

JSON exemple:

{
  "from":0,
  "size":0,
  "sort":[{"post_date":{"order":"desc"}}],
  "query":{
    "bool":{
      "must":[
        {"term":{"post_type.raw":"tnc_col_6_item"}},
        {"term":{"post_status":"publish"}}
      ]
    }
  },
  "aggs":{
    "872.taxonomy.tnc_tax_5":{
      "composite" : {
        "size": 2,
        "after" : { "tnc_tax_5" : "2" },
        "sources" : [
          { "tnc_tax_5": {
            "terms": {
              "script":{
                 "lang":"painless",
                 "source":"def c= ['']; for(term in params._source.terms.tnc_tax_5) { if(term.parent==0) { c.add(term.term_id); }} return c;"
              }
            }
          } }
        ]
      }
    }
  }
}






**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$formatted_args` | **mixed** |  |





***

### format_aggregations_items

Format ES aggregation response for items request

```php
private format_aggregations_items(mixed $aggregations): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$aggregations` | **mixed** |  |





***

### format_aggregations_facet

Format ES aggregation response for one facet request

```php
private format_aggregations_facet(mixed $aggregations): mixed
```








**Parameters:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `$aggregations` | **mixed** |  |





***


***
> Automatically generated on 2025-09-02
